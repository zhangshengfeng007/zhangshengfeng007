C51 COMPILER V9.60.7.0   PWM_DRIVER                                                        04/16/2024 15:41:20 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE PWM_DRIVER
OBJECT MODULE PLACED IN .\Objects\pwm_driver.obj
COMPILER INVOKED BY: F:\tool_start\keil_c51\C51\BIN\C51.EXE ..\Driver\pwm_driver.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Ap
                    -p\inc;..\Driver\inc) DEBUG OBJECTEXTEND PRINT(.\Listings\pwm_driver.lst) TABS(2) OBJECT(.\Objects\pwm_driver.obj)

line level    source

   1          #include "pwm_driver.h"
   2          
   3          #define   PW1En   (1<<7)
   4          #define   PWN1RATE  (0x07<<4)   //clock = Fosc/32
   5          #define   PWN1RATE1M  (0x02<<4)   //clock = Fosc/32
   6          #define   PWNV2   (0<<3)      //PWM20/21/22 conver
   7          #define   PWNV1   (0<<2)      //PWM10/11/12 conver
   8          
   9          void Pwm_Init(void)
  10          {
  11   1        //PWM1_Initial
  12   1        PW1YH = 0x00;   //fpwm1 = 1M/20=50k
  13   1        PW1YL = 0x06;   //Fre = 0
  14   1        PW1DH = 0x00;
  15   1        PW1DL = 0x00;   //Duty = 1
  16   1        
  17   1        PW1BH = PW1DH;
  18   1        PW1BL = PW1DL;    //死区B
  19   1        PW1A = 0x00;    //死区A
  20   1        
  21   1        //PW1CH =  0x77;
  22   1        PW1CH = 0;
  23   1        PW1M = PW1En | PWN1RATE | PWNV2 | PWNV1;
  24   1        
  25   1        Pwm_Open_Charge();
  26   1      }
  27          
  28          
  29          void Pwm_Set(uint16_t Frq_value,uint16_t duty_value)
  30          {
  31   1        uint16_t temp_cnt;
  32   1        
  33   1      //  if(duty_value>42) b_ChargeBusy_Set(1);
  34   1      //  else b_ChargeBusy_Set(0);
  35   1        
  36   1        temp_cnt = Frq_value;
  37   1        PW1YH = temp_cnt>>8;
  38   1        PW1YL = temp_cnt&0xff;
  39   1        //temp_cnt = temp_cnt*duty_value/Frq_value;
  40   1        temp_cnt = duty_value;
  41   1        PW1DH = temp_cnt>>8;
  42   1        PW1DL = temp_cnt&0xff;
  43   1        PW1BH = PW1DH;
  44   1        PW1BL = PW1DL;    //死区B
  45   1        PW1A = 0x00;    //死区A
  46   1        
  47   1        PW1M = PW1En | PWN1RATE | PWNV2 | PWNV1;
  48   1      }
  49          
  50          
  51          
  52          
  53          
  54          
C51 COMPILER V9.60.7.0   PWM_DRIVER                                                        04/16/2024 15:41:20 PAGE 2   

  55          
  56          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     70    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
